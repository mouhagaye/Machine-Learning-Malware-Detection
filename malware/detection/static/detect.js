document.querySelector('#myFile').onchange = () => {
    var x = document.getElementById("myFile");
    chemin = x.value.replace("C:\\fakepath\\", "");
    chemin = 'C:\\Users\\Mouhamadou Gaye\\Documents\\Projet Python\\StageSonatel\\Websites\\malware\\detection\\test\\'+chemin;
    window.notificationService.notify({
        title: 'Succés',
        text: 'Importaion Reussie !',
        type: 'success',
        position: 'top-right',
        autoClose: true,
        duration: 5000,
        showRemoveButton: true
    })
    document.querySelector('#resultat').innerHTML = 'Le chemin absolu du fichier importé est : '+chemin;
    document.querySelector('#resultat').style.color = "black";


    document.getElementById('boutton').addEventListener('click', () => {
        document.querySelector("#status").innerHTML = "<div id=\"result\" style=\"background-image: url(/static/img/loading.svg);\"></div>"
        const request =  new XMLHttpRequest();
        const path = chemin;
        request.open('POST','/analyse/')
    
        request.onload = () => {
    
            const data = JSON.parse(request.responseText);
    
            if(data.success){
                if(data.verdict == 'sain'){
                    document.querySelector('#resultat').style.color = "green";
                    document.querySelector('#resultat').innerHTML = "Le fichier analyse est sain! Vous pouvez l'executer en toute sécurité";
                    document.querySelector("#status").innerHTML = "<div id=\"result\" style=\"background-image: url(/static/img/safe.png);\"></div>"
                    
                }
                else if(data.verdict == 'malware'){
                    document.querySelector('#resultat').style.color = "red";
                    document.querySelector('#resultat').innerHTML = 'Le fichier analysé est un malware! Veuillez le supprimer ou le mettre en quarantaine'
                    document.querySelector("#status").innerHTML = "<div id=\"result\" style=\"background-image: url(/static/img/malware.png);\"></div>"
                                  
    
                }
                window.notificationService.notify({
                    title: 'Succés',
                    text: 'Le fichier a été analysé avec succéa',
                    type: 'success',
                    position: 'top-right',
                    autoClose: true,
                    duration: 5000,
                    showRemoveButton: true
                })
    
            }
            else{
                window.notificationService.notify({
                    title: 'Attention',
                    text: "Echec de l'analyse ! Veuillez entrer un fichier valide .",
                    type: 'warning',
                    position: 'top-right',
                    autoClose: true,
                    duration: 5000,
                    showRemoveButton: true
                })
                document.querySelector("#status").innerHTML = "<div id=\"result\" style=\"background-image: url(/static/img/pending.png);\"></div>"
    
            }
        }
        const data = new FormData();
        data.append('path',path);
        request.send(data);
        return false;
    })
    
    document.getElementById('supprimer').addEventListener('click', () => {
    
        
        document.querySelector("#status").innerHTML = "<div id=\"result\" style=\"background-image: url(/static/img/loading.svg);\"></div>"
        const request =  new XMLHttpRequest();
        const path = chemin;
        request.open('POST','/supprimer/');
    
        request.onload = () => {
    
            const donnee = JSON.parse(request.responseText);
    
            if(donnee.success){
                document.querySelector('#resultat').style.color = "green";
                document.querySelector('#resultat').innerHTML = "Le fichier a été supprimé avec succés";
                document.querySelector("#status").innerHTML = "<div id=\"result\" style=\"background-image: url(/static/img/pending.png);\"></div>"
                document.getElementById("myFile").value = "";
                window.notificationService.notify({
                    title: 'Succés',
                    text: 'Suppression Reussie !',
                    type: 'success',
                    position: 'top-right',
                    autoClose: true,
                    duration: 5000,
                    showRemoveButton: true
                })
    
            }
            else{
                window.notificationService.notify({
                    title: 'Erreur',
                    text: 'Echec de la Suppression!',
                    type: 'error',
                    position: 'top-right',
                    autoClose: true,
                    duration: 5000,
                    showRemoveButton: true
                })
                document.querySelector("#status").innerHTML = "<div id=\"result\" style=\"background-image: url(/static/img/pending.png);\"></div>"
    
            }
        }
        const donnees = new FormData();
        donnees.append('path',path);
        request.send(donnees);
        return false;
    })
    
    document.getElementById('quarantaine').addEventListener('click', () => {
    
        
        document.querySelector("#status").innerHTML = "<div id=\"result\" style=\"background-image: url(/static/img/loading.svg);\"></div>"
        const request =  new XMLHttpRequest();
        const path = chemin;
        request.open('POST','/quarantaine/');
    
        request.onload = () => {
    
            const datum = JSON.parse(request.responseText);
    
            if(datum.success){
                document.querySelector('#resultat').style.color = "green";
                document.querySelector('#resultat').innerHTML = "Le fichier a été mis en quarantaine avec succés";
                document.querySelector("#status").innerHTML = "<div id=\"result\" style=\"background-image: url(/static/img/pending.png);\"></div>"
                document.getElementById("myFile").value = "";
                window.notificationService.notify({
                    title: 'Succés',
                    text: 'Mise en Quarantaine Reussie !',
                    type: 'success',
                    position: 'top-right',
                    autoClose: true,
                    duration: 5000,
                    showRemoveButton: true
                })
    
            }
            else{
                window.notificationService.notify({
                    title: 'Erreur',
                    text: 'Echec de la Mise en Quarantaine!',
                    type: 'error',
                    position: 'top-right',
                    autoClose: true,
                    duration: 5000,
                    showRemoveButton: true
                })
                document.querySelector("#status").innerHTML = "<div id=\"result\" style=\"background-image: url(/static/img/pending.png);\"></div>"
    
            }
        }
        const datums = new FormData();
        datums.append('path',path);
        request.send(datums);
        return false;
    })


}